{% extends 'base.html' %}
{% load static %}
{% load rhitso_filters %}

{% block title %}Servicio T√©cnico - {{ block.super }}{% endblock %}

{% block extra_css %}
<!-- Font Awesome 6 - Iconos profesionales -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- CSS personalizado para Servicio T√©cnico - Dise√±o moderno y minimalista -->
<link rel="stylesheet" href="{% static 'css/servicio_tecnico_inicio.css' %}">
{% endblock %}

{% block content %}
<!--
================================================================================
SERVICIO T√âCNICO - DASHBOARD PRINCIPAL
================================================================================

EXPLICACI√ìN PARA PRINCIPIANTES:
Este es el dashboard principal del m√≥dulo de Servicio T√©cnico.
Muestra informaci√≥n clave sobre las √≥rdenes de servicio:
- Distribuci√≥n por estado
- Equipos por gama
- Carga de trabajo por t√©cnico
- √ìrdenes sin actualizaci√≥n reciente

El dise√±o es moderno, minimalista y f√°cil de navegar.
================================================================================
-->


<div class="st-dashboard-wrapper">
    <div class="container">
        
        <!-- ================================================================ -->
        <!-- SECCI√ìN HERO: Encabezado principal con √≠cono animado             -->
        <!-- ================================================================ -->
        <div class="st-hero-section">
            <div class="st-hero-icon">
                <i class="fas fa-screwdriver-wrench"></i>
            </div>
            <h1 class="st-hero-title">Dashboard de Servicio T√©cnico</h1>
            <p class="st-hero-subtitle">
                Gesti√≥n y seguimiento de √≥rdenes de reparaci√≥n en tiempo real
            </p>
        </div>

        <!-- ================================================================ -->
        <!-- BOT√ìN DE ACCI√ìN: Ver √ìrdenes Activas                             -->
        <!-- ================================================================ -->
        <div class="st-action-section">
            <a href="{% url 'servicio_tecnico:lista_activas' %}" class="st-btn-main">
                <i class="fas fa-eye"></i>
                <span>Ver √ìrdenes Activas</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>

        <!-- ================================================================ -->
        <!-- ROW 1: Distribuci√≥n por Estado y Equipos por Gama                -->
        <!-- ================================================================ -->
        <div class="row g-4 mb-4">
            
            <!-- DISTRIBUCI√ìN POR ESTADO -->
            <div class="col-lg-6">
                <div class="st-content-section">
                    <div class="st-section-header">
                        <h2 class="st-section-title">
                            <i class="fas fa-chart-bar"></i>
                            Distribuci√≥n por Estado
                        </h2>
                    </div>
                    
                    {% if ordenes_por_estado %}
                    <div class="st-estado-list">
                        {% for item in ordenes_por_estado %}
                        <div class="st-estado-item">
                            <div class="st-estado-badge">
                                <span class="badge bg-{{ item.estado|color_estado_orden }}">
                                    {{ item.estado_display }}
                                </span>
                            </div>
                            
                            <div class="st-estado-progress">
                                {% widthratio item.total total_ordenes 100 as porcentaje %}
                                <div class="st-estado-progress-fill" style="width: {{ porcentaje }}%;"></div>
                            </div>
                            
                            <div class="st-estado-count">{{ item.total }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="st-empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No hay √≥rdenes registradas a√∫n</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- EQUIPOS POR GAMA -->
            <div class="col-lg-6">
                <div class="st-content-section">
                    <div class="st-section-header">
                        <h2 class="st-section-title">
                            <i class="fas fa-laptop"></i>
                            Equipos por Gama (Activos)
                        </h2>
                    </div>
                    
                    <div class="st-gama-grid">
                        <div class="st-gama-item alta">
                            <i class="fas fa-star st-gama-icon"></i>
                            <div class="st-gama-number">{{ ordenes_gama_alta }}</div>
                            <div class="st-gama-label">Gama Alta</div>
                        </div>
                        
                        <div class="st-gama-item media">
                            <i class="fas fa-star-half-stroke st-gama-icon"></i>
                            <div class="st-gama-number">{{ ordenes_gama_media }}</div>
                            <div class="st-gama-label">Gama Media</div>
                        </div>
                        
                        <div class="st-gama-item baja">
                            <i class="far fa-star st-gama-icon"></i>
                            <div class="st-gama-number">{{ ordenes_gama_baja }}</div>
                            <div class="st-gama-label">Gama Baja</div>
                        </div>
                    </div>
                </div>
                
                <!-- DISTRIBUCI√ìN POR SUCURSAL -->
                <div class="st-content-section mt-4">
                    <div class="st-section-header">
                        <h2 class="st-section-title">
                            <i class="fas fa-building"></i>
                            Distribuci√≥n por Sucursal
                        </h2>
                    </div>
                    
                    {% if ordenes_por_sucursal %}
                    <div class="st-sucursal-list">
                        {% for item in ordenes_por_sucursal %}
                        <div class="st-sucursal-item">
                            <div class="st-sucursal-name">{{ item.sucursal__nombre }}</div>
                            <div class="st-sucursal-count">{{ item.total }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="st-empty-state">
                        <p>Sin √≥rdenes por sucursal</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ================================================================ -->
        <!-- CARGA DE TRABAJO POR T√âCNICO                                     -->
        <!-- ================================================================ -->
        {% if ordenes_por_tecnico %}
        <div class="st-content-section">
            <div class="st-section-header">
                <h2 class="st-section-title">
                    <i class="fas fa-users"></i>
                    Carga de Trabajo por T√©cnico
                </h2>
                <span class="badge bg-primary" style="font-size: 1rem; padding: 0.5rem 1rem;">
                    {{ ordenes_por_tecnico|length }} t√©cnico{{ ordenes_por_tecnico|length|pluralize }}
                </span>
            </div>
            
            <div class="st-tecnicos-grid">
                {% for tecnico in ordenes_por_tecnico %}
                <div class="st-tecnico-card">
                    <div class="st-tecnico-avatar">
                        {% if tecnico.foto_url %}
                            <img src="{{ tecnico.foto_url }}" alt="{{ tecnico.tecnico_nombre }}">
                        {% else %}
                            <div class="st-tecnico-avatar-placeholder">
                                {{ tecnico.iniciales }}
                            </div>
                        {% endif %}
                    </div>
                    <div class="st-tecnico-name">{{ tecnico.tecnico_nombre }}</div>
                    <div class="st-tecnico-orders">{{ tecnico.total_ordenes }}</div>
                    <div class="st-tecnico-label">√ìrdenes Activas</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- ================================================================ -->
        <!-- √ìRDENES SIN ACTUALIZACI√ìN (Top 10)                               -->
        <!-- ================================================================ -->
        <div class="st-content-section">
            <div class="st-section-header">
                <h2 class="st-section-title">
                    <i class="fas fa-clock-rotate-left"></i>
                    √ìrdenes sin Actualizaci√≥n de Estado (Top 10)
                </h2>
                <a href="{% url 'servicio_tecnico:lista_activas' %}" class="btn btn-outline-primary btn-sm">
                    Ver Todas <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            {% if ordenes_sin_actualizacion %}
            <div class="st-ordenes-list">
                {% for orden in ordenes_sin_actualizacion %}
                <div class="st-orden-card">
                    <div class="st-orden-header">
                        <a href="{% url 'servicio_tecnico:detalle_orden' orden.pk %}" 
                           class="st-orden-numero">
                            {% if orden.orden_cliente %}
                                {{ orden.orden_cliente }}
                            {% else %}
                                {{ orden.numero_orden_interno }}
                            {% endif %}
                        </a>
                        <span class="st-orden-fecha">
                            <i class="far fa-calendar"></i>
                            √öltima actualizaci√≥n: {{ orden.fecha_ultimo_estado|date:"d/m/Y H:i" }}
                        </span>
                    </div>

                    <div class="st-orden-equipo">
                        <i class="fas fa-laptop"></i>
                        <strong>{{ orden.marca }} {{ orden.modelo }}</strong>
                        {% if orden.numero_serie %}
                        <br><small class="text-muted">S/N: {{ orden.numero_serie }}</small>
                        {% endif %}
                    </div>

                    <div class="st-orden-footer">
                        <div class="st-orden-tecnico">
                            <i class="fas fa-user-gear"></i>
                            {{ orden.tecnico_nombre }}
                        </div>
                        <div>
                            <span class="badge bg-secondary">{{ orden.estado_display }}</span>
                        </div>
                        <div class="st-orden-dias">
                            {{ orden.dias_sin_actualizacion }} d√≠a{{ orden.dias_sin_actualizacion|pluralize }} sin cambios
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="st-empty-state">
                <i class="fas fa-check-circle"></i>
                <p>No hay √≥rdenes sin actualizaci√≥n recientes</p>
            </div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<!--
================================================================================
JAVASCRIPT PARA INTERACTIVIDAD MEJORADA
================================================================================

EXPLICACI√ìN PARA PRINCIPIANTES:
Este script agrega funcionalidades adicionales:
- Atajos de teclado para navegaci√≥n r√°pida
- Efectos de hover mejorados
- Mensajes de consola para desarrolladores
================================================================================
-->
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // ========================================================================
    // ATAJO DE TECLADO - Tecla "A" para Ver √ìrdenes Activas
    // ========================================================================
    document.addEventListener('keydown', function(e) {
        if (e.key === 'a' || e.key === 'A') {
            if (!e.ctrlKey && !e.altKey && !e.metaKey) {
                const activeElement = document.activeElement;
                if (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    window.location.href = "{% url 'servicio_tecnico:lista_activas' %}";
                }
            }
        }
    });
    
    // ========================================================================
    // MENSAJE DE CONSOLA PARA DESARROLLADORES
    // ========================================================================
    console.log('%cüîß Dashboard de Servicio T√©cnico Cargado', 'color: #F59E0B; font-size: 16px; font-weight: bold;');
    console.log('%cAtajo de teclado disponible:', 'color: #6B7280; font-size: 12px;');
    console.log('%c  ‚Ä¢ Presiona "A" para Ver √ìrdenes Activas', 'color: #F59E0B; font-size: 12px;');
});
</script>
{% endblock %}
